<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè• PantelMed - –ú–µ–¥–∏—á–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–µ –º–µ–Ω—é */
        .navigation {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-container {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
        }
        
        .nav-menu {
            display: flex;
            gap: 15px;
        }
        
        .nav-button {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .nav-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }
        
        .nav-button.active {
            background: rgba(255,255,255,0.3);
            border-color: white;
        }
        
        /* –ú–µ–¥–∏—á–Ω–∏–π –∫–≤—ñ–∑ */
        .medical-quiz {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #4CAF50;
        }
        
        .quiz-question {
            margin-bottom: 20px;
        }
        
        .quiz-options {
            display: grid;
            gap: 12px;
            margin: 15px 0;
        }
        
        .quiz-option {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .quiz-option:hover {
            border-color: #4CAF50;
            background: #f0f8f0;
        }
        
        .quiz-option.selected {
            border-color: #4CAF50;
            background: #e8f5e9;
        }
        
        .quiz-option input[type="radio"] {
            margin: 0;
        }
        
        .quiz-result {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #2196F3;
            display: none;
        }
        
        .quiz-result.show {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        
        .upgrade-offer {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .upgrade-offer h3 {
            color: white;
            margin-bottom: 15px;
        }
        
        .upgrade-offer .price {
            font-size: 28px;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .upgrade-features {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .upgrade-features ul {
            list-style: none;
            padding: 0;
        }
        
        .upgrade-features li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upgrade-features li::before {
            content: "‚úÖ";
            font-size: 16px;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        /* Telegram Login */
        .telegram-login-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
            border-left: 4px solid #0088cc;
        }
        
        .telegram-user-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            vertical-align: middle;
        }
        
        /* –°—Ç–∞—Ç—É—Å –ø—ñ–¥–ø–∏—Å–∫–∏ */
        .subscription-status {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .status-active {
            border-left: 4px solid #4CAF50;
            background: #e8f5e9;
        }
        
        .status-inactive {
            border-left: 4px solid #ff9800;
            background: #fff3e0;
        }
        
        /* –ú–æ–±—ñ–ª—å–Ω–∞ –∞–¥–∞–ø—Ç–∞—Ü—ñ—è */
        @media (max-width: 480px) {
            .nav-container {
                flex-direction: column;
                gap: 10px;
                padding: 0 15px;
            }
            
            .nav-menu {
                width: 100%;
                justify-content: center;
            }
            
            .nav-button {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–µ –º–µ–Ω—é -->
    <nav class="navigation">
        <div class="nav-container">
            <a href="#" class="logo">üè• PantelMed</a>
            <div class="nav-menu">
                <a href="#" class="nav-button active" onclick="showSubscription()">
                    üíä –ü—ñ–¥–ø–∏—Å–∫–∞
                </a>
                <a href="shop.html" class="nav-button">
                    üõí PantelMed Shop
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="header">
            <h1>üè• PantelMed</h1>
            <p>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –º–µ–¥–∏—á–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤–∞—à–∏—Ö –ø–æ—Ç—Ä–µ–±</p>
        </div>
        
        <div class="content">
            <!-- Telegram Login Integration -->
            <div id="telegram-section" class="telegram-login-section">
                <h3>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Telegram</h3>
                <p>–£–≤—ñ–π–¥—ñ—Ç—å —á–µ—Ä–µ–∑ Telegram –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å–≤—ñ–¥—É</p>
                <div id="telegram-login-widget"></div>
                <div id="telegram-user-info" class="telegram-user-info" style="display: none;"></div>
            </div>
            
            <!-- –°—Ç–∞—Ç—É—Å –ø—ñ–¥–ø–∏—Å–∫–∏ -->
            <div id="subscription-status" class="subscription-status">
                <h3>üìä –°—Ç–∞—Ç—É—Å –ø—ñ–¥–ø–∏—Å–∫–∏</h3>
                <div id="status-content">üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –≤–∞—à —Å—Ç–∞—Ç—É—Å...</div>
            </div>
            
            <!-- –ú–µ–¥–∏—á–Ω–∏–π –∫–≤—ñ–∑ -->
            <div class="medical-quiz">
                <h3>ü©∫ –®–≤–∏–¥–∫–∞ –æ—Ü—ñ–Ω–∫–∞ –≤–∞—à–æ–≥–æ —Å—Ç–∞–Ω—É –∑–¥–æ—Ä–æ–≤'—è</h3>
                <p>–í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ —Ü–µ –ø–∏—Ç–∞–Ω–Ω—è –¥–æ–ø–æ–º–æ–∂–µ –Ω–∞–º –¥–∞—Ç–∏ –≤–∞–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</p>
                
                <div class="quiz-question">
                    <h4>–Ø–∫—ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑—ñ –∑–¥–æ—Ä–æ–≤'—è–º –≤–∞—Å –Ω–∞–π–±—ñ–ª—å—à–µ —Ç—É—Ä–±—É—é—Ç—å?</h4>
                    
                    <div class="quiz-options">
                        <label class="quiz-option" onclick="selectQuizOption('energy')">
                            <input type="radio" name="health_concern" value="energy">
                            <div>
                                <strong>‚ö° –ù–∏–∑—å–∫–∞ –µ–Ω–µ—Ä–≥—ñ—è —Ç–∞ –≤—Ç–æ–º–∞</strong><br>
                                <small>–®–≤–∏–¥–∫–æ –≤—Ç–æ–º–ª—é—é—Å—è, –≤—ñ–¥—á—É–≤–∞—é –∞–ø–∞—Ç—ñ—é, –Ω–µ –≤–∏—Å—Ç–∞—á–∞—î —Å–∏–ª</small>
                            </div>
                        </label>
                        
                        <label class="quiz-option" onclick="selectQuizOption('immunity')">
                            <input type="radio" name="health_concern" value="immunity">
                            <div>
                                <strong>üõ°Ô∏è –°–ª–∞–±–∫–∏–π —ñ–º—É–Ω—ñ—Ç–µ—Ç</strong><br>
                                <small>–ß–∞—Å—Ç–æ —Ö–≤–æ—Ä—ñ—é, –¥–æ–≤–≥–æ –æ–¥—É–∂—É—é, –ø—ñ–¥—Ö–æ–ø–ª—é—é –≤—Å–µ</small>
                            </div>
                        </label>
                        
                        <label class="quiz-option" onclick="selectQuizOption('stress')">
                            <input type="radio" name="health_concern" value="stress">
                            <div>
                                <strong>üò∞ –°—Ç—Ä–µ—Å —ñ –ø—Ä–æ–±–ª–µ–º–∏ –∑—ñ —Å–Ω–æ–º</strong><br>
                                <small>–ü–æ—Å—Ç—ñ–π–Ω–∏–π —Å—Ç—Ä–µ—Å, –ø–æ–≥–∞–Ω–∏–π —Å–æ–Ω, —Ç—Ä–∏–≤–æ–∂–Ω—ñ—Å—Ç—å</small>
                            </div>
                        </label>
                        
                        <label class="quiz-option" onclick="selectQuizOption('weight')">
                            <input type="radio" name="health_concern" value="weight">
                            <div>
                                <strong>‚öñÔ∏è –ü—Ä–æ–±–ª–µ–º–∏ –∑ –≤–∞–≥–æ—é</strong><br>
                                <small>–•–æ—á—É —Å—Ö—É–¥–∞—Ç–∏ –∞–±–æ –Ω–∞–±—Ä–∞—Ç–∏ –≤–∞–≥—É, –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –æ–±–º—ñ–Ω —Ä–µ—á–æ–≤–∏–Ω</small>
                            </div>
                        </label>
                        
                        <label class="quiz-option" onclick="selectQuizOption('hormones')">
                            <input type="radio" name="health_concern" value="hormones">
                            <div>
                                <strong>‚öóÔ∏è –ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏</strong><br>
                                <small>–©–∏—Ç–æ–≤–∏–¥–∫–∞, –≥–æ—Ä–º–æ–Ω–∏ —Å—Ç–∞—Ç—ñ, –º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–∏–π —Ü–∏–∫–ª</small>
                            </div>
                        </label>
                        
                        <label class="quiz-option" onclick="selectQuizOption('general')">
                            <input type="radio" name="health_concern" value="general">
                            <div>
                                <strong>üéØ –ó–∞–≥–∞–ª—å–Ω–µ –æ–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–Ω—è</strong><br>
                                <small>–•–æ—á—É –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è –≤ —Ü—ñ–ª–æ–º—É, –ø—Ä–æ—Ñ—ñ–ª–∞–∫—Ç–∏–∫–∞</small>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–≤—ñ–∑—É -->
            <div id="quiz-result" class="quiz-result">
                <h3>üéØ –í–∞—à—ñ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h3>
                <div id="result-content"></div>
                
                <!-- –ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è —Ä–æ–∑—à–∏—Ä–µ–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó -->
                <div class="upgrade-offer">
                    <h3>üöÄ –û—Ç—Ä–∏–º–∞–π—Ç–µ –ø–æ–≤–Ω—É –ø—Ä–æ–≥—Ä–∞–º—É –æ–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–Ω—è!</h3>
                    
                    <div class="upgrade-features">
                        <ul>
                            <li>–î–µ—Ç–∞–ª—å–Ω–∏–π —Å—Ç–µ–∫ –¥–æ–±–∞–≤–æ–∫ –∑ —Ç–æ—á–Ω–∏–º –¥–æ–∑—É–≤–∞–Ω–Ω—è–º</li>
                            <li>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∞–Ω–∞–ª—ñ–∑—ñ–≤ –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É</li>
                            <li>–í—ñ–¥–µ–æ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —Ç–∞ —Ä–æ–∑'—è—Å–Ω–µ–Ω–Ω—è</li>
                            <li>AI —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä –≤–∞—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</li>
                            <li>30 –¥–Ω—ñ–≤ –ø—Ä–µ–º—ñ—É–º –¥–æ—Å—Ç—É–ø—É</li>
                        </ul>
                    </div>
                    
                    <div class="price">üíé –¢—ñ–ª—å–∫–∏ $2.60</div>
                    
                    <button class="btn-primary" onclick="goToUpgrade()" style="width: 100%; margin-top: 15px; background: rgba(255,255,255,0.2); border: 2px solid white;">
                        üéØ –ö—É–ø–∏—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω—É –≤–µ—Ä—Å—ñ—é
                    </button>
                </div>
            </div>
            
            <div class="user-info">
                <strong>üÜî –í–∞—à ID:</strong> <span class="user-id" id="userIdDisplay">–ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è...</span>
                <div style="margin-top: 8px; font-size: 12px; color: #666;">
                    –¶–µ–π ID –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ –¥–ª—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–ª–∞—Ç–µ–∂—ñ–≤
                </div>
            </div>
            
            <!-- –ü—Ä–µ–º—ñ—É–º –∫–æ–Ω—Ç–µ–Ω—Ç (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –ø—ñ–¥–ø–∏—Å–Ω–∏–∫—ñ–≤) -->
            <div id="premiumContent" class="premium-content" style="display: none;">
                <h3>üéâ –ü—Ä–µ–º—ñ—É–º –¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∏–π!</h3>
                <div id="subscriptionInfo" class="subscription-info"></div>
                
                <div class="features">
                    <div class="feature-item">
                        <div class="feature-icon">üìÑ</div>
                        <div class="feature-content">
                            <h3>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —Å—Ç–µ–∫ –¥–æ–±–∞–≤–æ–∫</h3>
                            <p>–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –≤—ñ—Ç–∞–º—ñ–Ω–∏ —Ç–∞ –º—ñ–Ω–µ—Ä–∞–ª–∏ –∑ —Ç–æ—á–Ω–∏–º –¥–æ–∑—É–≤–∞–Ω–Ω—è–º</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">üß™</div>
                        <div class="feature-content">
                            <h3>–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∞–Ω–∞–ª—ñ–∑—ñ–≤</h3>
                            <p>–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ñ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∑–¥–æ—Ä–æ–≤'—è</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">üé•</div>
                        <div class="feature-content">
                            <h3>–í—ñ–¥–µ–æ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó</h3>
                            <p>–î–µ—Ç–∞–ª—å–Ω—ñ —Ä–æ–∑'—è—Å–Ω–µ–Ω–Ω—è —è–∫ —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</p>
                        </div>
                    </div>
                    
                    <div class="feature-item">
                        <div class="feature-icon">üß†</div>
                        <div class="feature-content">
                            <h3>AI –Ü–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä</h3>
                            <p>–®—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –º–µ–¥–∏—á–Ω–∏—Ö –ø–æ–∫–∞–∑–Ω–∏–∫—ñ–≤</p>
                        </div>
                    </div>
                </div>
                
                <button onclick="downloadContent()" class="btn-primary">
                    üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏
                </button>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_BASE = 'https://pantelmed-api.onrender.com';
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
        let currentTelegramUser = null;
        let userId = null;
        let selectedHealthConcern = null;
        let hasActiveSubscription = false;

        // Telegram Web App —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        function initTelegramWebApp() {
            if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    const telegramUser = tg.initDataUnsafe.user;
                    handleTelegramLogin(telegramUser, 'webapp');
                }
            }
        }

        // Telegram Login Widget
        function initTelegramLoginWidget() {
            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://telegram.org/js/telegram-widget.js?22';
            script.setAttribute('data-telegram-login', 'pantelmed_bot');
            script.setAttribute('data-size', 'large');
            script.setAttribute('data-radius', '10');
            script.setAttribute('data-onauth', 'onTelegramAuth(user)');
            script.setAttribute('data-request-access', 'write');
            
            document.getElementById('telegram-login-widget').appendChild(script);
        }

        function onTelegramAuth(user) {
            handleTelegramLogin(user, 'widget');
        }

        async function handleTelegramLogin(telegramUser, source) {
            try {
                currentTelegramUser = telegramUser;
                
                const response = await fetch(`${API_BASE}/api/telegram-login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        telegram_user: telegramUser,
                        source: source
                    })
                });

                const result = await response.json();
                
                if (result.status === 'success') {
                    userId = result.user_id;
                    showTelegramUserInfo(telegramUser);
                    document.getElementById('userIdDisplay').textContent = userId;
                    checkSubscriptionStatus();
                } else {
                    console.error('Telegram login failed:', result.error);
                }
            } catch (error) {
                console.error('Telegram login error:', error);
            }
        }

        function showTelegramUserInfo(user) {
            const userInfoDiv = document.getElementById('telegram-user-info');
            userInfoDiv.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center;">
                    ${user.photo_url ? `<img src="${user.photo_url}" class="user-avatar" alt="Avatar">` : 'üë§'}
                    <div>
                        <strong>üéâ –í—ñ—Ç–∞—î–º–æ, ${user.first_name}!</strong><br>
                        <small>@${user.username || 'no_username'} | Telegram ID: ${user.id}</small>
                    </div>
                </div>
            `;
            userInfoDiv.style.display = 'block';
            document.getElementById('telegram-login-widget').style.display = 'none';
        }

        // –ú–µ–¥–∏—á–Ω–∏–π –∫–≤—ñ–∑
        function selectQuizOption(concern) {
            selectedHealthConcern = concern;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä
            document.querySelectorAll('.quiz-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            showQuizResult(concern);
        }

        function showQuizResult(concern) {
            const resultDiv = document.getElementById('quiz-result');
            const contentDiv = document.getElementById('result-content');
            
            const recommendations = {
                energy: {
                    title: "‚ö° –ë–æ—Ä–æ—Ç—å–±–∞ –∑ –≤—Ç–æ–º–æ—é —Ç–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó",
                    description: "–í–∞—à–∞ –ø—Ä–æ–±–ª–µ–º–∞ –¥—É–∂–µ –ø–æ—à–∏—Ä–µ–Ω–∞ —ñ —á–∞—Å—Ç–æ –ø–æ–≤'—è–∑–∞–Ω–∞ –∑ –¥–µ—Ñ—ñ—Ü–∏—Ç–æ–º –∫–ª—é—á–æ–≤–∏—Ö –º—ñ–∫—Ä–æ–µ–ª–µ–º–µ–Ω—Ç—ñ–≤.",
                    short_tips: ["–í—ñ—Ç–∞–º—ñ–Ω B12 –¥–ª—è –µ–Ω–µ—Ä–≥—ñ—ó", "–ó–∞–ª—ñ–∑–æ –ø—Ä–∏ –∞–Ω–µ–º—ñ—ó", "–ú–∞–≥–Ω—ñ–π –¥–ª—è –º'—è–∑—ñ–≤", "–ö–æ–µ–Ω–∑–∏–º Q10 –¥–ª—è –∫–ª—ñ—Ç–∏–Ω"],
                    limitation: "–¶–µ –±–∞–∑–æ–≤—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó. –î–ª—è —Ç–æ—á–Ω–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ä–æ–∑—à–∏—Ä–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è."
                },
                immunity: {
                    title: "üõ°Ô∏è –ó–º—ñ—Ü–Ω–µ–Ω–Ω—è —ñ–º—É–Ω–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏",
                    description: "–°–ª–∞–±–∫–∏–π —ñ–º—É–Ω—ñ—Ç–µ—Ç —á–∞—Å—Ç–æ –≤–∫–∞–∑—É—î –Ω–∞ –¥–µ—Ñ—ñ—Ü–∏—Ç —Ü–∏–Ω–∫—É, –≤—ñ—Ç–∞–º—ñ–Ω—É D —Ç–∞ –ø–æ—Ä—É—à–µ–Ω–Ω—è –º—ñ–∫—Ä–æ—Ñ–ª–æ—Ä–∏.",
                    short_tips: ["–í—ñ—Ç–∞–º—ñ–Ω D3 –≤–∑–∏–º–∫—É", "–¶–∏–Ω–∫ –ø—Ä–∏ –ø—Ä–æ—Å—Ç—É–¥–∞—Ö", "–í—ñ—Ç–∞–º—ñ–Ω C —â–æ–¥–Ω—è", "–ü—Ä–æ–±—ñ–æ—Ç–∏–∫–∏ –¥–ª—è –∫–∏—à–µ—á–Ω–∏–∫–∞"],
                    limitation: "–î–ª—è –ø–æ–≤–Ω–æ—ó —ñ–º—É–Ω–Ω–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–æ–∑—É–≤–∞–Ω–Ω—è —Ç–∞ –∞–Ω–∞–ª—ñ–∑–∏."
                },
                stress: {
                    title: "üò∞ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç—Ä–µ—Å–æ–º —Ç–∞ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Å–Ω—É",
                    description: "–•—Ä–æ–Ω—ñ—á–Ω–∏–π —Å—Ç—Ä–µ—Å –≤–∏—Å–Ω–∞–∂—É—î –Ω–∞–¥–Ω–∏—Ä–∫–Ω–∏–∫–∏ —Ç–∞ –ø–æ—Ä—É—à—É—î –±–∞–ª–∞–Ω—Å –≥–æ—Ä–º–æ–Ω—ñ–≤ —Å—Ç—Ä–µ—Å—É.",
                    short_tips: ["–ú–∞–≥–Ω—ñ–π –ø–µ—Ä–µ–¥ —Å–Ω–æ–º", "–ê—à–≤–∞–≥–∞–Ω–¥–∞ –≤—ñ–¥ —Å—Ç—Ä–µ—Å—É", "–ú–µ–ª–∞—Ç–æ–Ω—ñ–Ω –¥–ª—è —Å–Ω—É", "–í—ñ—Ç–∞–º—ñ–Ω–∏ B –≤—ñ–¥ –≤—Ç–æ–º–∏"],
                    limitation: "–°—Ç—Ä–µ—Å –ø–æ—Ç—Ä–µ–±—É—î —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É –∑ –∞–Ω–∞–ª—ñ–∑–∞–º–∏ –∫–æ—Ä—Ç–∏–∑–æ–ª—É."
                },
                weight: {
                    title: "‚öñÔ∏è –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –≤–∞–≥–∏ —Ç–∞ –º–µ—Ç–∞–±–æ–ª—ñ–∑–º—É",
                    description: "–ü—Ä–æ–±–ª–µ–º–∏ –∑ –≤–∞–≥–æ—é —á–∞—Å—Ç–æ –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω–∏–º–∏ –ø–æ—Ä—É—à–µ–Ω–Ω—è–º–∏ —Ç–∞ –ø–æ–≤—ñ–ª—å–Ω–∏–º –º–µ—Ç–∞–±–æ–ª—ñ–∑–º–æ–º.",
                    short_tips: ["L-–∫–∞—Ä–Ω—ñ—Ç–∏–Ω –¥–ª—è —Å–ø–∞–ª—é–≤–∞–Ω–Ω—è", "–•—Ä–æ–º –¥–ª—è —Ü—É–∫—Ä—É", "–û–º–µ–≥–∞-3 –¥–ª—è –º–µ—Ç–∞–±–æ–ª—ñ–∑–º—É", "–í—ñ—Ç–∞–º—ñ–Ω D –¥–ª—è –≥–æ—Ä–º–æ–Ω—ñ–≤"],
                    limitation: "–°—Ö—É–¥–Ω–µ–Ω–Ω—è –ø–æ—Ç—Ä–µ–±—É—î –∞–Ω–∞–ª—ñ–∑—ñ–≤ —â–∏—Ç–æ–≤–∏–¥–∫–∏ —Ç–∞ —ñ–Ω—Å—É–ª—ñ–Ω—É."
                },
                hormones: {
                    title: "‚öóÔ∏è –ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω–∏–π –±–∞–ª–∞–Ω—Å",
                    description: "–ì–æ—Ä–º–æ–Ω–∞–ª—å–Ω–∏–π –¥–∏—Å–±–∞–ª–∞–Ω—Å –≤–ø–ª–∏–≤–∞—î –Ω–∞ –≤–µ—Å—å –æ—Ä–≥–∞–Ω—ñ–∑–º —ñ –ø–æ—Ç—Ä–µ–±—É—î –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É.",
                    short_tips: ["–í—ñ—Ç–∞–º—ñ–Ω D –¥–ª—è –≥–æ—Ä–º–æ–Ω—ñ–≤", "–û–º–µ–≥–∞-3 –¥–ª—è –±–∞–ª–∞–Ω—Å—É", "–ú–∞–≥–Ω—ñ–π –¥–ª—è –∂—ñ–Ω–æ–∫", "–¶–∏–Ω–∫ –¥–ª—è —á–æ–ª–æ–≤—ñ–∫—ñ–≤"],
                    limitation: "–ì–æ—Ä–º–æ–Ω–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –¥–µ—Ç–∞–ª—å–Ω–∏—Ö –∞–Ω–∞–ª—ñ–∑—ñ–≤ —Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É."
                },
                general: {
                    title: "üéØ –ó–∞–≥–∞–ª—å–Ω–µ –æ–∑–¥–æ—Ä–æ–≤–ª–µ–Ω–Ω—è —Ç–∞ –ø—Ä–æ—Ñ—ñ–ª–∞–∫—Ç–∏–∫–∞",
                    description: "–ü—Ä–æ—Ñ—ñ–ª–∞–∫—Ç–∏–∫–∞ - –Ω–∞–π–∫—Ä–∞—â–∏–π —Å–ø–æ—Å—ñ–± –ø—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –∑–¥–æ—Ä–æ–≤'—è –Ω–∞ –¥–æ–≤–≥—ñ —Ä–æ–∫–∏.",
                    short_tips: ["–ú—É–ª—å—Ç–∏–≤—ñ—Ç–∞–º—ñ–Ω–∏ —â–æ–¥–Ω—è", "–û–º–µ–≥–∞-3 –¥–ª—è —Å–µ—Ä—Ü—è", "–í—ñ—Ç–∞–º—ñ–Ω D –≤–∑–∏–º–∫—É", "–ü—Ä–æ–±—ñ–æ—Ç–∏–∫–∏ –¥–ª—è —Ç—Ä–∞–≤–ª–µ–Ω–Ω—è"],
                    limitation: "–î–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –±–∞–∑–æ–≤—ñ –∞–Ω–∞–ª—ñ–∑–∏."
                }
            };
            
            const rec = recommendations[concern];
            
            contentDiv.innerHTML = `
                <h4>${rec.title}</h4>
                <p>${rec.description}</p>
                
                <div style="background: #f0f8f0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>üíä –ë–∞–∑–æ–≤—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:</strong>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        ${rec.short_tips.map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                    <div style="background: #fff3e0; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 14px;">
                        ‚ö†Ô∏è <strong>–û–±–º–µ–∂–µ–Ω–Ω—è:</strong> ${rec.limitation}
                    </div>
                </div>
            `;
            
            resultDiv.classList.add('show');
        }

        // –§—É–Ω–∫—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        function generateUserId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function getUserId() {
            if (userId) return userId;
            
            let storedUserId = localStorage.getItem('pantelmed_user_id');
            if (!storedUserId) {
                storedUserId = generateUserId();
                localStorage.setItem('pantelmed_user_id', storedUserId);
                console.log('–°—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤–∏–π User ID:', storedUserId);
            }
            userId = storedUserId;
            return storedUserId;
        }

        async function checkSubscriptionStatus() {
            const currentUserId = getUserId();
            try {
                const response = await fetch(`${API_BASE}/subscription-status`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUserId })
                });

                const data = await response.json();
                
                const statusDiv = document.getElementById('subscription-status');
                const statusContent = document.getElementById('status-content');

                if (data.has_subscription && data.active) {
                    hasActiveSubscription = true;
                    statusDiv.className = 'subscription-status status-active';
                    statusContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 48px;">‚úÖ</div>
                            <div>
                                <h4 style="margin: 0; color: #2e7d32;">–ü—Ä–µ–º—ñ—É–º –ø—ñ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞!</h4>
                                <p style="margin: 5px 0; color: #388e3c;">
                                    <strong>üìÖ –î–æ:</strong> ${new Date(data.expires_at).toLocaleDateString('uk-UA')} 
                                    <strong>‚è∞ –ó–∞–ª–∏—à–∏–ª–æ—Å—å:</strong> ${data.days_left} –¥–Ω—ñ–≤
                                </p>
                            </div>
                        </div>
                    `;
                    
                    // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–µ–º—ñ—É–º –∫–æ–Ω—Ç–µ–Ω—Ç
                    document.getElementById('premiumContent').style.display = 'block';
                    document.getElementById('subscriptionInfo').innerHTML = `
                        <strong>üìÖ –ê–∫—Ç–∏–≤–Ω–∞ –¥–æ:</strong> ${new Date(data.expires_at).toLocaleDateString('uk-UA')}<br>
                        <strong>‚è∞ –ó–∞–ª–∏—à–∏–ª–æ—Å—å:</strong> ${data.days_left} –¥–Ω—ñ–≤
                    `;
                } else {
                    hasActiveSubscription = false;
                    statusDiv.className = 'subscription-status status-inactive';
                    statusContent.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 48px;">üîí</div>
                            <div>
                                <h4 style="margin: 0; color: #f57c00;">–ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞</h4>
                                <p style="margin: 5px 0; color: #ef6c00;">
                                    –ü—Ä–æ–π–¥—ñ—Ç—å –º–µ–¥–∏—á–Ω–∏–π –∫–≤—ñ–∑ —Ç–∞ –æ—Ç—Ä–∏–º–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
                                </p>
                            </div>
                        </div>
                    `;
                    
                    // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø—Ä–µ–º—ñ—É–º –∫–æ–Ω—Ç–µ–Ω—Ç
                    document.getElementById('premiumContent').style.display = 'none';
                }
            } catch (error) {
                console.error('Error checking subscription:', error);
                document.getElementById('status-content').innerHTML = `
                    <div style="color: #666;">‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å –ø—ñ–¥–ø–∏—Å–∫–∏</div>
                `;
            }
        }

        function downloadContent() {
            if (!hasActiveSubscription) {
                alert("üîí –°–ø–æ—á–∞—Ç–∫—É –∞–∫—Ç–∏–≤—É–π—Ç–µ –ø—ñ–¥–ø–∏—Å–∫—É!");
                return;
            }
            alert("üì• –§—É–Ω–∫—Ü—ñ—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—É–¥–µ –¥–æ–¥–∞–Ω–∞ –≤ –Ω–∞—Å—Ç—É–ø–Ω–æ–º—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—ñ!");
        }

        // –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
        function showSubscription() {
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.nav-button[onclick="showSubscription()"]').classList.add('active');
        }

        function goToUpgrade() {
            if (hasActiveSubscription) {
                alert("‚úÖ –£ –≤–∞—Å –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∞ –ø—ñ–¥–ø–∏—Å–∫–∞!");
                return;
            }
            
            // –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –æ–ø–ª–∞—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫–∏ –∑ –æ–±—Ä–∞–Ω–æ—é –ø—Ä–æ–±–ª–µ–º–æ—é
            const concern = selectedHealthConcern || 'general';
            window.location.href = `pay.html?type=subscription&user_id=${getUserId()}&concern=${concern}`;
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('PantelMed —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
            
            const currentUserId = getUserId();
            document.getElementById('userIdDisplay').textContent = currentUserId;
            
            initTelegramWebApp();
            
            setTimeout(() => {
                if (!currentTelegramUser) {
                    initTelegramLoginWidget();
                }
            }, 1000);
            
            checkSubscriptionStatus();
        });

        // –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É
        setInterval(() => {
            if (document.visibilityState === 'visible') {
                console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É...');
                checkSubscriptionStatus();
            }
        }, 30000);

        // –û–±—Ä–æ–±–∫–∞ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (–∑ Telegram –±–æ—Ç–∞)
        const urlParams = new URLSearchParams(window.location.search);
        const telegramUserId = urlParams.get('user_id');
        const source = urlParams.get('source');

        if (telegramUserId && source === 'telegram') {
            fetch(`${API_BASE}/api/telegram-user/${telegramUserId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.telegram_id) {
                        handleTelegramLogin({
                            id: data.telegram_id,
                            first_name: data.first_name,
                            last_name: data.last_name,
                            username: data.username,
                            photo_url: data.photo_url
                        }, 'bot_redirect');
                    }
                })
                .catch(error => console.log('Bot redirect user not found'));
        }
    </script>
</body>
</html>
