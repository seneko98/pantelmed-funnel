<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí≥ –û–ø–ª–∞—Ç–∞ –ø—ñ–¥–ø–∏—Å–∫–∏ - PantelMed</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –°–¢–ò–õ–Ü –î–õ–Ø –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–Ü–á */
        .payment-tracker {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .progress-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 2s linear infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .progress-text {
            text-align: center;
        }
        
        #progress-status {
            font-size: 12px;
            display: block;
            margin-bottom: 5px;
        }
        
        #progress-time {
            font-size: 18px;
            font-weight: bold;
        }
        
        .tracker-info {
            margin-top: 20px;
        }
        
        .tracker-info p {
            margin: 5px 0;
            opacity: 0.9;
        }
        
        .success-animation {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            animation: fadeInScale 0.5s ease-out;
        }
        
        .success-animation .checkmark {
            font-size: 60px;
            margin-bottom: 20px;
            animation: bounce 0.8s ease-out;
        }
        
        .manual-check-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-waiting { background: #ffc107; }
        .status-checking { background: #007bff; animation: pulse 1s infinite; }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeInScale {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .notification-area {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .notification {
            background: #007bff;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üí≥ –û–ø–ª–∞—Ç–∞ –ø—ñ–¥–ø–∏—Å–∫–∏</h1>
            <h2>PantelMed - –†–æ–∑—à–∏—Ä–µ–Ω–∏–π –¥–æ—Å—Ç—É–ø</h2>
        </header>

        <div class="user-info">
            <h3>üÜî –í–∞—à —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID</h3>
            <div class="user-id" id="user-id">–ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è...</div>
            <p class="id-info">–¶–µ–π ID –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ –¥–ª—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–ª–∞—Ç–µ–∂—ñ–≤</p>
        </div>

        <div class="subscription-info">
            <h3>‚ÑπÔ∏è –©–æ –≤–∫–ª—é—á–∞—î –ø—ñ–¥–ø–∏—Å–∫–∞</h3>
            <ul>
                <li>üìÑ –ü–æ–≤–Ω–∏–π —Å—Ç–µ–∫ –¥–æ–±–∞–≤–æ–∫ –∑ –¥–æ–∑—É–≤–∞–Ω–Ω—è–º</li>
                <li>üß™ –†–æ–∑—à–∏—Ä–µ–Ω–∏–π —Å–ø–∏—Å–æ–∫ –∞–Ω–∞–ª—ñ–∑—ñ–≤</li>
                <li>üé• –í—ñ–¥–µ–æ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó —Ç–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏</li>
                <li>üß† AI —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤</li>
                <li>‚è∞ –î–æ—Å—Ç—É–ø –Ω–∞ 30 –¥–Ω—ñ–≤</li>
            </ul>
        </div>

        <div class="payment-section">
            <h3>–°—É–º–∞ –¥–æ –æ–ø–ª–∞—Ç–∏:</h3>
            <div class="amount"><strong>2.6 USDT</strong></div>
            <p class="network">TRC-20 Network (Tron)</p>

            <div class="wallet-info">
                <h4>üí∞ –ê–¥—Ä–µ—Å–∞ –¥–ª—è –æ–ø–ª–∞—Ç–∏:</h4>
                <div class="wallet-address">
                    <span id="wallet-address">TQeHa8VdwfyybxtioW4ggbnDC1rbWe8nFa</span>
                    <button class="copy-btn" onclick="copyWalletAddress()">üìã Copy</button>
                </div>
            </div>

            <div class="payment-steps">
                <h4>üìã –ö—Ä–æ–∫–∏ –¥–ª—è –æ–ø–ª–∞—Ç–∏:</h4>
                <div class="step">
                    <span class="step-number">1</span>
                    <span class="step-text">–°–∫–æ–ø—ñ—é–π—Ç–µ –∞–¥—Ä–µ—Å—É –≥–∞–º–∞–Ω—Ü—è (–∫–Ω–æ–ø–∫–∞ üìã Copy)</span>
                </div>
                <div class="step">
                    <span class="step-number">2</span>
                    <span class="step-text">–ù–∞–¥—ñ—à–ª—ñ—Ç—å —Ä—ñ–≤–Ω–æ 2.6 USDT —á–µ—Ä–µ–∑ TRC-20 –º–µ—Ä–µ–∂—É</span>
                </div>
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-text">–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏—è–≤–∏—Ç—å –≤–∞—à –ø–ª–∞—Ç—ñ–∂</span>
                </div>
                <div class="step">
                    <span class="step-number">4</span>
                    <span class="step-text">–û—Ç—Ä–∏–º–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –ø—Ä–æ—Ç—è–≥–æ–º 1-5 —Ö–≤–∏–ª–∏–Ω</span>
                </div>
            </div>

            <!-- –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ê –ü–ï–†–ï–í–Ü–†–ö–ê -->
            <div id="payment-status" class="payment-status">
                <div class="manual-check-section">
                    <h4>üîç –°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂—É</h4>
                    <p><span class="status-indicator status-waiting"></span>–û—á—ñ–∫—É—î–º–æ –≤–∞—à –ø–ª–∞—Ç—ñ–∂...</p>
                    <button class="payment-btn" onclick="startPaymentProcess()">üöÄ –ü–æ—á–∞—Ç–∏ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è</button>
                    <p class="manual-option">
                        <small>–ê–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å 
                            <button class="link-btn" onclick="manualPaymentCheck()">
                                "–Ø –≤–∂–µ –æ–ø–ª–∞—Ç–∏–≤"
                            </button> 
                            –¥–ª—è —Ä—É—á–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
                        </small>
                    </p>
                </div>
            </div>
        </div>

        <div class="help-section">
            <h4>üîÑ –ü—Ä–æ–±–ª–µ–º–∏ –∑ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—î—é?</h4>
            <p>–Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑ ID, –º–æ–∂–Ω–∞ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –Ω–æ–≤–∏–π:</p>
            <button class="regenerate-btn" onclick="regenerateUserId()">üÜî –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –Ω–æ–≤–∏–π ID</button>
        </div>
    </div>

    <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω—å -->
    <div class="notification-area" id="notification-area"></div>

    <script>
        // –ê–í–¢–û–ú–ê–¢–ò–ó–û–í–ê–ù–ê –°–ò–°–¢–ï–ú–ê –ü–õ–ê–¢–ï–ñ–Ü–í
        let currentUserId = null;
        let paymentTracker = null;
        let notificationPermission = false;

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            initializePaymentSystem();
            requestNotificationPermission();
        });

        function initializePaymentSystem() {
            console.log('üöÄ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ –ø–ª–∞—Ç–µ–∂—ñ–≤...');
            
            // –ì–µ–Ω–µ—Ä—É—î–º–æ –∞–±–æ –æ—Ç—Ä–∏–º—É—î–º–æ —ñ—Å–Ω—É—é—á–∏–π user ID
            currentUserId = generateOrGetUserId();
            document.getElementById('user-id').textContent = currentUserId;
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—ó –ø—ñ–¥–ø–∏—Å–∫–∏
            checkExistingSubscription();
        }

        function generateOrGetUserId() {
            let userId = localStorage.getItem('pantelmed_user_id');
            
            if (!userId) {
                const timestamp = Date.now();
                const randomStr = Math.random().toString(36).substring(2, 15);
                userId = `web_${timestamp}_${randomStr}`;
                localStorage.setItem('pantelmed_user_id', userId);
            }
            
            return userId;
        }

        function regenerateUserId() {
            localStorage.removeItem('pantelmed_user_id');
            currentUserId = generateOrGetUserId();
            document.getElementById('user-id').textContent = currentUserId;
            showNotification('üÜî –ù–æ–≤–∏–π ID –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ: ' + currentUserId, 'info');
        }

        async function checkExistingSubscription() {
            try {
                const response = await fetch('/subscription-status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUserId })
                });

                const result = await response.json();
                
                if (result.has_subscription && result.active) {
                    showExistingSubscription(result);
                }
            } catch (error) {
                console.log('–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–ø–∏—Å–∫–∏: –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ—ó –ø—ñ–¥–ø–∏—Å–∫–∏');
            }
        }

        function showExistingSubscription(subscription) {
            document.getElementById('payment-status').innerHTML = `
                <div class="success-animation">
                    <div class="checkmark">‚úÖ</div>
                    <h3>–£ –≤–∞—Å –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∞ –ø—ñ–¥–ø–∏—Å–∫–∞!</h3>
                    <p>–î—ñ—î –¥–æ: ${new Date(subscription.expires_at).toLocaleDateString('uk-UA')}</p>
                    <p>–ó–∞–ª–∏—à–∏–ª–æ—Å—å –¥–Ω—ñ–≤: ${subscription.days_left}</p>
                    <button onclick="window.location.href='/'" class="payment-btn">
                        üè† –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤
                    </button>
                </div>
            `;
        }

        // –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ï –í–Ü–î–°–¢–ï–ñ–ï–ù–ù–Ø –ü–õ–ê–¢–ï–ñ–Ü–í
        class PaymentTracker {
            constructor(userId) {
                this.userId = userId;
                this.checkInterval = null;
                this.attempts = 0;
                this.maxAttempts = 120; // 60 —Ö–≤–∏–ª–∏–Ω –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ (–∫–æ–∂–Ω—ñ 30 —Å–µ–∫)
                this.timeLeft = 60 * 60; // 60 —Ö–≤–∏–ª–∏–Ω –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                this.timerInterval = null;
            }
            
            startTracking() {
                console.log('üîÑ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—ñ–≤...');
                
                this.showProgressIndicator();
                this.startTimer();
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
                this.checkInterval = setInterval(() => {
                    this.checkPayment();
                }, 30000);
                
                // –ü–µ—Ä—à–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–¥—Ä–∞–∑—É
                this.checkPayment();
                
                showNotification('üîç –†–æ–∑–ø–æ—á–∞—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–ª–∞—Ç–µ–∂—É', 'info');
            }
            
            startTimer() {
                this.timerInterval = setInterval(() => {
                    this.timeLeft--;
                    this.updateTimer();
                    
                    if (this.timeLeft <= 0) {
                        this.onTimeout();
                    }
                }, 1000);
            }
            
            updateTimer() {
                const minutes = Math.floor(this.timeLeft / 60);
                const seconds = this.timeLeft % 60;
                const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                const timerElement = document.getElementById('progress-time');
                if (timerElement) {
                    timerElement.textContent = timeString;
                }
            }
            
            async checkPayment() {
                this.attempts++;
                
                try {
                    document.getElementById('progress-status').textContent = '–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –±–ª–æ–∫—á–µ–π–Ω...';
                    
                    const response = await fetch('/check-payment', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            user_id: this.userId,
                            auto_check: true
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.access === "granted") {
                        this.onPaymentSuccess(result);
                    } else if (this.attempts >= this.maxAttempts) {
                        this.onTimeout();
                    } else {
                        this.updateProgress();
                        showNotification(`üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ ${this.attempts}/${this.maxAttempts}`, 'info', 2000);
                    }
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏:', error);
                    document.getElementById('progress-status').textContent = '–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, –ø–æ–≤—Ç–æ—Ä—é—î–º–æ...';
                }
            }
            
            updateProgress() {
                const progressPercent = (this.attempts / this.maxAttempts) * 100;
                document.getElementById('progress-status').textContent = 
                    `–ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ ${this.attempts}/${this.maxAttempts} —Ä–∞–∑—ñ–≤`;
                
                // –û–Ω–æ–≤–ª—é—î–º–æ –∫–æ–ª—å–æ—Ä–∏ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø—Ä–æ–≥—Ä–µ—Å—É
                const circle = document.querySelector('.progress-circle');
                if (progressPercent > 75) {
                    circle.style.borderTopColor = '#ffc107'; // –ñ–æ–≤—Ç–∏–π - –º–∞–π–∂–µ –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è —á–∞—Å
                }
            }
            
            onPaymentSuccess(result) {
                this.stopTracking();
                
                showNotification('‚úÖ –ü–ª–∞—Ç—ñ–∂ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!', 'success');
                
                if (notificationPermission) {
                    new Notification('‚úÖ PantelMed - –ü–ª–∞—Ç—ñ–∂ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!', {
                        body: '–í–∞—à–∞ –ø—ñ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞. –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ!',
                        icon: '/favicon.ico'
                    });
                }
                
                this.showSuccessAnimation(result);
                
                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –ø—ñ–¥–ø–∏—Å–∫–∏
                localStorage.setItem('pantelmed_subscription', JSON.stringify(result.subscription));
                
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    window.location.href = "/thankyou.html";
                }, 5000);
            }
            
            onTimeout() {
                this.stopTracking();
                
                showNotification('‚è∞ –ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è', 'warning');
                
                document.getElementById('payment-status').innerHTML = `
                    <div class="manual-check-section">
                        <h4>‚è∞ –ß–∞—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–∞–∫—ñ–Ω—á–∏–≤—Å—è</h4>
                        <p>–ú–æ–∂–ª–∏–≤–æ, –≤–∞—à–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤—Å–µ —â–µ –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è.</p>
                        <button onclick="manualPaymentCheck()" class="payment-btn">
                            üîç –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—Ä—É—á–Ω—É
                        </button>
                        <button onclick="startPaymentProcess()" class="regenerate-btn">
                            üîÑ –ü–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ
                        </button>
                    </div>
                `;
            }
            
            stopTracking() {
                if (this.checkInterval) {
                    clearInterval(this.checkInterval);
                    this.checkInterval = null;
                }
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }
            
            showProgressIndicator() {
                document.getElementById('payment-status').innerHTML = `
                    <div class="payment-tracker">
                        <div class="progress-circle">
                            <div class="progress-text">
                                <span id="progress-status">–ó–∞–ø—É—Å–∫ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è...</span>
                                <span id="progress-time">60:00</span>
                            </div>
                        </div>
                        <div class="tracker-info">
                            <p>üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É—î–º–æ –≤–∞—à—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é</p>
                            <p>‚è±Ô∏è –ó–∞–∑–≤–∏—á–∞–π –∑–∞–π–º–∞—î 1-5 —Ö–≤–∏–ª–∏–Ω</p>
                            <p>üí° –ú–æ–∂–µ—Ç–µ –∑–∞–∫—Ä–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É - –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å—Å—è</p>
                            <button onclick="paymentTracker.stopTracking(); showManualSection()" 
                                    style="margin-top: 15px; background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                ‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
                            </button>
                        </div>
                    </div>
                `;
            }
            
            showSuccessAnimation(result) {
                document.getElementById('payment-status').innerHTML = `
                    <div class="success-animation">
                        <div class="checkmark">‚úÖ</div>
                        <h3>–ü–ª–∞—Ç—ñ–∂ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!</h3>
                        <p>üí∞ –°—É–º–∞: ${result.transaction?.amount || '2.6'} USDT</p>
                        <p>üìÖ –ü—ñ–¥–ø–∏—Å–∫–∞ –¥–æ: ${new Date(result.subscription.expires_at).toLocaleDateString('uk-UA')}</p>
                        <p>üéâ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –≤–∞—Å –¥–æ –ø—Ä–µ–º—ñ—É–º –∫–æ–Ω—Ç–µ–Ω—Ç—É...</p>
                        <div class="countdown" id="redirect-countdown">5</div>
                    </div>
                `;
                
                // –í—ñ–¥–ª—ñ–∫ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
                let countdown = 5;
                const countdownElement = document.getElementById('redirect-countdown');
                const countdownInterval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                    }
                }, 1000);
            }
        }

        // –§–£–ù–ö–¶–Ü–á –£–ü–†–ê–í–õ–Ü–ù–ù–Ø
        function startPaymentProcess() {
            if (paymentTracker) {
                paymentTracker.stopTracking();
            }
            
            paymentTracker = new PaymentTracker(currentUserId);
            paymentTracker.startTracking();
        }

        async function manualPaymentCheck() {
            showNotification('üîç –†—É—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂—É...', 'info');
            
            try {
                const response = await fetch('/check-payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: currentUserId })
                });

                const result = await response.json();
                
                if (result.access === "granted") {
                    if (paymentTracker) {
                        paymentTracker.onPaymentSuccess(result);
                    } else {
                        showNotification('‚úÖ –ü–ª–∞—Ç—ñ–∂ –∑–Ω–∞–π–¥–µ–Ω–æ!', 'success');
                        setTimeout(() => window.location.href = "/thankyou.html", 2000);
                    }
                } else {
                    showNotification('‚ùå ' + (result.message || '–ü–ª–∞—Ç—ñ–∂ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ'), 'error');
                }
            } catch (error) {
                showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂—É', 'error');
                console.error('Payment check error:', error);
            }
        }

        function showManualSection() {
            document.getElementById('payment-status').innerHTML = `
                <div class="manual-check-section">
                    <h4>üîç –†—É—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞</h4>
                    <p>–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–ª–∞—Ç—ñ–∂ –≤—Ä—É—á–Ω—É –∞–±–æ –ø–æ—á–Ω—ñ—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–∞–Ω–æ–≤–æ</p>
                    <button onclick="manualPaymentCheck()" class="payment-btn">
                        ‚úÖ –Ø –æ–ø–ª–∞—Ç–∏–≤ - –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏
                    </button>
                    <button onclick="startPaymentProcess()" class="regenerate-btn">
                        üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è
                    </button>
                </div>
            `;
        }

        // –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á
        function copyWalletAddress() {
            const address = document.getElementById('wallet-address').textContent;
            navigator.clipboard.writeText(address).then(() => {
                showNotification('üìã –ê–¥—Ä–µ—Å—É —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!', 'success', 2000);
            });
        }

        async function requestNotificationPermission() {
            if ("Notification" in window && Notification.permission === "default") {
                const permission = await Notification.requestPermission();
                notificationPermission = permission === "granted";
            } else {
                notificationPermission = Notification.permission === "granted";
            }
        }

        function showNotification(message, type = 'info', duration = 5000) {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            const colors = {
                success: '#28a745',
                error: '#dc3545', 
                warning: '#ffc107',
                info: '#007bff'
            };
            
            notification.style.background = colors[type] || colors.info;
            
            document.getElementById('notification-area').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, duration);
        }

        // –û—á–∏—â–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.addEventListener('beforeunload', () => {
            if (paymentTracker) {
                paymentTracker.stopTracking();
            }
        });
    </script>
</body>
</html>
